<UserControl x:Class="WhatsAppSimHubPlugin.UI.Tabs.LedEffectsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins"
             xmlns:xctk="clr-namespace:Xceed.Wpf.Toolkit;assembly=Xceed.Wpf.Toolkit">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">

            <!-- ======== LED Notifications Master ======== -->
            <TextBlock Text="LED Notifications"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <StackPanel Margin="0,0,0,20">
                <!-- Master Toggle -->
                <styles:SHToggleCheckbox x:Name="LedEffectsEnabledCheckbox"
                         Content="Enable LED effects on message notifications"
                         FontSize="13"
                         Foreground="White"
                         Margin="0,0,0,12"/>

                <!-- Priority Toggles -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                    <TextBlock Text="Trigger on:"
                               FontSize="12"
                               Foreground="#858585"
                               VerticalAlignment="Center"
                               Margin="0,0,12,0"/>
                    <styles:SHToggleCheckbox x:Name="LedNormalCheckbox"
                             Content="Normal"
                             FontSize="12"
                             Foreground="White"
                             Margin="0,0,15,0"/>
                    <styles:SHToggleCheckbox x:Name="LedVipCheckbox"
                             Content="VIP"
                             FontSize="12"
                             Foreground="White"
                             Margin="0,0,15,0"/>
                    <styles:SHToggleCheckbox x:Name="LedUrgentCheckbox"
                             Content="Urgent"
                             FontSize="12"
                             Foreground="White"
                             Margin="0,0,0,0"/>
                </StackPanel>

                <!-- Flash Speed -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                    <TextBlock Text="Flash speed:"
                               FontSize="12"
                               Foreground="#858585"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <Slider x:Name="FlashSpeedSlider"
                            Minimum="100" Maximum="1000"
                            TickFrequency="50"
                            IsSnapToTickEnabled="True"
                            Width="180"
                            VerticalAlignment="Center"
                            Value="250"/>
                    <TextBlock x:Name="FlashSpeedValue"
                               Text="250ms"
                               FontSize="12"
                               Foreground="#4EC9B0"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"/>
                </StackPanel>

                <!-- Info Box -->
                <Border Background="#1E3A5F" Padding="12" CornerRadius="6" Margin="0,0,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#x2139;&#xFE0F;" FontSize="18" Margin="0,0,12,0" VerticalAlignment="Top" Foreground="White"/>
                        <TextBlock TextWrapping="Wrap" Foreground="White" FontSize="12" LineHeight="18">
                            LED effects activate when a message notification is displayed.
                            <LineBreak/>
                            Effect duration matches the message display duration set in the Notifications tab.
                            <LineBreak/>
                            Devices are detected automatically from SimHub.
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- ======== LED Devices ======== -->
            <TextBlock Text="LED Devices"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <ItemsControl x:Name="LedDevicesContainer">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#252526"
                                BorderBrush="#3E3E42"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,10">
                            <StackPanel>
                                <!-- Device Header -->
                                <Border Background="#2D2D30" CornerRadius="4,4,0,0" Padding="10,8"
                                        Cursor="Hand"
                                        MouseLeftButtonUp="DeviceHeader_Click">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding ExpandArrow}"
                                                   FontSize="11"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        <CheckBox Grid.Column="1"
                                                  IsChecked="{Binding Enabled, Mode=TwoWay}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,10,0"/>
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DeviceName}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Text="RGB LEDs"
                                                       FontSize="11"
                                                       Foreground="#858585"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding LedCountText}"
                                                       FontSize="11"
                                                       Foreground="#4EC9B0"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <!-- Device Body -->
                                <StackPanel Margin="14,10,14,14" Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibility}}">
                                    <TextBlock Text="Flash Colors"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="#AAAAAA"
                                               Margin="0,0,0,8"/>
                                    <!-- Normal Color -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Normal:"
                                                   Width="70"
                                                   FontSize="12"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding NormalColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True"
                                                          ShowRecentColors="False"
                                                          DisplayColorAndName="False"
                                                          ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <!-- VIP Color -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="VIP:"
                                                   Width="70"
                                                   FontSize="12"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding VipColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True"
                                                          ShowRecentColors="False"
                                                          DisplayColorAndName="False"
                                                          ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <!-- Urgent Color -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Urgent:"
                                                   Width="70"
                                                   FontSize="12"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding UrgentColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True"
                                                          ShowRecentColors="False"
                                                          DisplayColorAndName="False"
                                                          ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <!-- Test Buttons -->
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <styles:SHButtonPrimary Content="Test Normal" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestNormal_Click"/>
                                        <styles:SHButtonPrimary Content="Test VIP" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestVip_Click"/>
                                        <styles:SHButtonPrimary Content="Test Urgent" Height="28" Padding="12,4"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestUrgent_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock x:Name="NoLedDevicesText"
                       Text="No LED devices detected"
                       FontSize="12"
                       Foreground="#858585"
                       FontStyle="Italic"
                       Margin="0,0,0,20"
                       Visibility="Collapsed"/>

            <!-- ======== Matrix Devices ======== -->
            <TextBlock Text="Matrix Devices"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,10,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <ItemsControl x:Name="MatrixDevicesContainer">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#252526"
                                BorderBrush="#3E3E42"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,10">
                            <StackPanel>
                                <!-- Device Header -->
                                <Border Background="#2D2D30" CornerRadius="4,4,0,0" Padding="10,8"
                                        Cursor="Hand"
                                        MouseLeftButtonUp="DeviceHeader_Click">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding ExpandArrow}"
                                                   FontSize="11"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        <CheckBox Grid.Column="1"
                                                  IsChecked="{Binding Enabled, Mode=TwoWay}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,10,0"/>
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DeviceName}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Text="RGB Matrix"
                                                       FontSize="11"
                                                       Foreground="#858585"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding MatrixSizeText}"
                                                       FontSize="11"
                                                       Foreground="#4EC9B0"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <!-- Device Body -->
                                <StackPanel Margin="14,10,14,14" Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibility}}">
                                    <!-- Display Mode -->
                                    <TextBlock Text="Display Mode"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="#AAAAAA"
                                               Margin="0,0,0,8"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <RadioButton x:Name="FlashAllRadio"
                                                     Content="Flash All"
                                                     IsChecked="{Binding IsFlashAll, Mode=TwoWay}"
                                                     Foreground="White"
                                                     FontSize="12"
                                                     Margin="0,0,15,0"/>
                                        <RadioButton Content="Envelope Icon"
                                                     IsChecked="{Binding IsEnvelopeIcon, Mode=TwoWay}"
                                                     Foreground="White"
                                                     FontSize="12"/>
                                    </StackPanel>
                                    <!-- Colors -->
                                    <TextBlock Text="Colors"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="#AAAAAA"
                                               Margin="0,0,0,8"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Normal:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding NormalColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True" ShowRecentColors="False"
                                                          DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="VIP:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding VipColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True" ShowRecentColors="False"
                                                          DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Urgent:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding UrgentColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True" ShowRecentColors="False"
                                                          DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <styles:SHButtonPrimary Content="Test Normal" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestNormal_Click"/>
                                        <styles:SHButtonPrimary Content="Test VIP" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestVip_Click"/>
                                        <styles:SHButtonPrimary Content="Test Urgent" Height="28" Padding="12,4"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestUrgent_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock x:Name="NoMatrixDevicesText"
                       Text="No matrix devices detected"
                       FontSize="12"
                       Foreground="#858585"
                       FontStyle="Italic"
                       Margin="0,0,0,20"
                       Visibility="Collapsed"/>

            <!-- ======== Arduino Global ======== -->
            <TextBlock Text="Arduino (Global)"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,10,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <ItemsControl x:Name="ArduinoDevicesContainer">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#252526"
                                BorderBrush="#3E3E42"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,10">
                            <StackPanel>
                                <Border Background="#2D2D30" CornerRadius="4,4,0,0" Padding="10,8"
                                        Cursor="Hand"
                                        MouseLeftButtonUp="DeviceHeader_Click">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding ExpandArrow}"
                                                   FontSize="11"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        <CheckBox Grid.Column="1"
                                                  IsChecked="{Binding Enabled, Mode=TwoWay}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,10,0"/>
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DeviceName}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Text="Global Driver"
                                                       FontSize="11"
                                                       Foreground="#858585"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding LedCountText}"
                                                       FontSize="11"
                                                       Foreground="#4EC9B0"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <StackPanel Margin="14,10,14,14" Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibility}}">
                                    <!-- Matrix mode selector for ArduinoMatrix -->
                                    <StackPanel Visibility="{Binding IsMatrixDevice, Converter={StaticResource BoolToVisibility}}">
                                        <TextBlock Text="Display Mode"
                                                   FontSize="13" FontWeight="SemiBold"
                                                   Foreground="#AAAAAA" Margin="0,0,0,8"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <RadioButton Content="Flash All"
                                                         IsChecked="{Binding IsFlashAll, Mode=TwoWay}"
                                                         Foreground="White" FontSize="12"
                                                         Margin="0,0,15,0"/>
                                            <RadioButton Content="Envelope Icon"
                                                         IsChecked="{Binding IsEnvelopeIcon, Mode=TwoWay}"
                                                         Foreground="White" FontSize="12"/>
                                        </StackPanel>
                                    </StackPanel>
                                    <TextBlock Text="Flash Colors"
                                               FontSize="13" FontWeight="SemiBold"
                                               Foreground="#AAAAAA" Margin="0,0,0,8"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Normal:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding NormalColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True" ShowRecentColors="False"
                                                          DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="VIP:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding VipColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True" ShowRecentColors="False"
                                                          DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                        <TextBlock Text="Urgent:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                        <xctk:ColorPicker SelectedColor="{Binding UrgentColorValue, Mode=TwoWay}"
                                                          Width="100" Height="22"
                                                          ShowStandardColors="True" ShowRecentColors="False"
                                                          DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <styles:SHButtonPrimary Content="Test Normal" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestNormal_Click"/>
                                        <styles:SHButtonPrimary Content="Test VIP" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestVip_Click"/>
                                        <styles:SHButtonPrimary Content="Test Urgent" Height="28" Padding="12,4"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestUrgent_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock x:Name="NoArduinoDevicesText"
                       Text="No Arduino LED devices detected"
                       FontSize="12"
                       Foreground="#858585"
                       FontStyle="Italic"
                       Margin="0,0,0,20"
                       Visibility="Collapsed"/>

            <!-- ======== Philips Hue ======== -->
            <TextBlock Text="Philips Hue"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,10,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <ItemsControl x:Name="HueDevicesContainer">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#252526"
                                BorderBrush="#3E3E42"
                                BorderThickness="1"
                                CornerRadius="4"
                                Margin="0,0,0,10">
                            <StackPanel>
                                <Border Background="#2D2D30" CornerRadius="4,4,0,0" Padding="10,8"
                                        Cursor="Hand"
                                        MouseLeftButtonUp="DeviceHeader_Click">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding ExpandArrow}"
                                                   FontSize="11"
                                                   Foreground="#858585"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        <CheckBox Grid.Column="1"
                                                  IsChecked="{Binding Enabled, Mode=TwoWay}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,10,0"/>
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DeviceName}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Text="Hue Group"
                                                       FontSize="11"
                                                       Foreground="#858585"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding LedCountText}"
                                                       FontSize="11"
                                                       Foreground="#4EC9B0"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                <StackPanel Margin="14,10,14,14" Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibility}}">
                                    <!-- Select Lights -->
                                    <TextBlock Text="Select Lights"
                                               FontSize="13" FontWeight="SemiBold"
                                               Foreground="#AAAAAA" Margin="0,0,0,8"/>
                                    <ItemsControl ItemsSource="{Binding Lights}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#2D2D30"
                                                        Padding="4,4,8,4"
                                                        CornerRadius="3"
                                                        Margin="0,0,8,8">
                                                    <StackPanel Orientation="Horizontal">
                                                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                  VerticalAlignment="Center"
                                                                  Margin="0,0,4,0"/>
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontSize="11"
                                                                   Foreground="#CCCCCC"
                                                                   VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Effects per priority -->
                                    <TextBlock Text="Effects"
                                               FontSize="13" FontWeight="SemiBold"
                                               Foreground="#AAAAAA" Margin="0,4,0,8"/>

                                    <!-- Normal -->
                                    <Border Background="#1E1E1E" Padding="8" CornerRadius="4" Margin="0,0,0,8">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <Ellipse Width="8" Height="8" Fill="#4CAF50" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                <TextBlock Text="Normal" FontSize="12" FontWeight="SemiBold" Foreground="#AAAAAA"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="Effect:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <ComboBox SelectedIndex="{Binding HueNormalEffectIndex, Mode=TwoWay}"
                                                          Width="160" FontSize="12">
                                                    <ComboBoxItem Content="Flash (1 color)"/>
                                                    <ComboBoxItem Content="Alternating (2 colors)"/>
                                                </ComboBox>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="Color 1:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <xctk:ColorPicker SelectedColor="{Binding NormalColorValue, Mode=TwoWay}"
                                                                  Width="100" Height="22"
                                                                  ShowStandardColors="True" ShowRecentColors="False"
                                                                  DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,0"
                                                        Visibility="{Binding IsNormalAlternating, Converter={StaticResource BoolToVisibility}}">
                                                <TextBlock Text="Color 2:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <xctk:ColorPicker SelectedColor="{Binding HueColor2NormalValue, Mode=TwoWay}"
                                                                  Width="100" Height="22"
                                                                  ShowStandardColors="True" ShowRecentColors="False"
                                                                  DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- VIP -->
                                    <Border Background="#1E1E1E" Padding="8" CornerRadius="4" Margin="0,0,0,8">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <Ellipse Width="8" Height="8" Fill="#FF9800" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                <TextBlock Text="VIP" FontSize="12" FontWeight="SemiBold" Foreground="#AAAAAA"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="Effect:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <ComboBox SelectedIndex="{Binding HueVipEffectIndex, Mode=TwoWay}"
                                                          Width="160" FontSize="12">
                                                    <ComboBoxItem Content="Flash (1 color)"/>
                                                    <ComboBoxItem Content="Alternating (2 colors)"/>
                                                </ComboBox>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="Color 1:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <xctk:ColorPicker SelectedColor="{Binding VipColorValue, Mode=TwoWay}"
                                                                  Width="100" Height="22"
                                                                  ShowStandardColors="True" ShowRecentColors="False"
                                                                  DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,0"
                                                        Visibility="{Binding IsVipAlternating, Converter={StaticResource BoolToVisibility}}">
                                                <TextBlock Text="Color 2:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <xctk:ColorPicker SelectedColor="{Binding HueColor2VipValue, Mode=TwoWay}"
                                                                  Width="100" Height="22"
                                                                  ShowStandardColors="True" ShowRecentColors="False"
                                                                  DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Urgent -->
                                    <Border Background="#1E1E1E" Padding="8" CornerRadius="4" Margin="0,0,0,8">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <Ellipse Width="8" Height="8" Fill="#F44336" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                <TextBlock Text="Urgent" FontSize="12" FontWeight="SemiBold" Foreground="#AAAAAA"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="Effect:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <ComboBox SelectedIndex="{Binding HueUrgentEffectIndex, Mode=TwoWay}"
                                                          Width="160" FontSize="12">
                                                    <ComboBoxItem Content="Flash (1 color)"/>
                                                    <ComboBoxItem Content="Alternating (2 colors)"/>
                                                </ComboBox>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="Color 1:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <xctk:ColorPicker SelectedColor="{Binding UrgentColorValue, Mode=TwoWay}"
                                                                  Width="100" Height="22"
                                                                  ShowStandardColors="True" ShowRecentColors="False"
                                                                  DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,0"
                                                        Visibility="{Binding IsUrgentAlternating, Converter={StaticResource BoolToVisibility}}">
                                                <TextBlock Text="Color 2:" Width="70" FontSize="12" Foreground="#858585" VerticalAlignment="Center"/>
                                                <xctk:ColorPicker SelectedColor="{Binding HueColor2UrgentValue, Mode=TwoWay}"
                                                                  Width="100" Height="22"
                                                                  ShowStandardColors="True" ShowRecentColors="False"
                                                                  DisplayColorAndName="False" ColorMode="ColorPalette"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Test Buttons -->
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <styles:SHButtonPrimary Content="Test Normal" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestNormal_Click"/>
                                        <styles:SHButtonPrimary Content="Test VIP" Height="28" Padding="12,4"
                                                               Margin="0,0,8,0"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestVip_Click"/>
                                        <styles:SHButtonPrimary Content="Test Urgent" Height="28" Padding="12,4"
                                                               Tag="{Binding DeviceId}"
                                                               Click="TestUrgent_Click"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock x:Name="NoHueDevicesText"
                       Text="No Philips Hue groups detected. Configure Hue in SimHub's Ambient Lights settings."
                       FontSize="12"
                       Foreground="#858585"
                       FontStyle="Italic"
                       Margin="0,0,0,5"/>

            <!-- Hue Info Box -->
            <Border Background="#1E3A5F" Padding="12" CornerRadius="6" Margin="0,5,0,20">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#x2139;&#xFE0F;" FontSize="18" Margin="0,0,12,0" VerticalAlignment="Top" Foreground="White"/>
                    <TextBlock TextWrapping="Wrap" Foreground="White" FontSize="12" LineHeight="18">
                        Philips Hue groups are loaded from SimHub's Ambient Lights configuration.
                        <LineBreak/>
                        Flash (1 color): All selected lights flash the same color.
                        <LineBreak/>
                        Alternating (2 colors): Lights alternate between two colors (requires 2+ lights selected).
                    </TextBlock>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
