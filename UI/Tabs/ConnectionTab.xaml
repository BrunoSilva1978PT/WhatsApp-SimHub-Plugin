<UserControl x:Class="WhatsAppSimHubPlugin.UI.Tabs.ConnectionTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">
            <!-- Connection Status -->
            <TextBlock Text="Connection Status"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <StackPanel Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Ellipse x:Name="StatusIndicator" Width="15" Height="15"
                             Fill="#E74877" Margin="0,0,10,0"/>
                    <TextBlock x:Name="StatusText" Text="Disconnected"
                               FontSize="14" VerticalAlignment="Center"/>
                </StackPanel>

                <TextBlock x:Name="ConnectedNumberText" Text="No number connected"
                           Margin="0,0,0,10"/>

                <StackPanel Orientation="Horizontal">
                    <styles:SHButtonSecondary x:Name="DisconnectButton" Content="Disconnect"
                            Width="100" Height="30" Margin="0,0,10,0" IsEnabled="False"
                            Background="#E74877" Foreground="White"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                    <styles:SHButtonPrimary x:Name="ReconnectButton" Content="Connect"
                            Width="100" Height="30" Margin="0,0,10,0"
                            Background="#0E7A0D" Foreground="White"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                    <styles:SHButtonSecondary x:Name="ResetSessionButton" Content="Reset Session"
                            Width="110" Height="30"
                            Background="#FF9800" Foreground="White"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <!-- QR Code -->
            <TextBlock Text="QR Code"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <StackPanel Margin="0,0,0,20">
                <Image x:Name="QRCodeImage" Width="300" Height="300"
                       Stretch="Uniform" Margin="0,0,0,10"
                       HorizontalAlignment="Left" Visibility="Collapsed"/>

                <TextBlock x:Name="QRCodeInstructions" TextWrapping="Wrap"
                           Visibility="Collapsed">
                    <Run Text="To connect:"/>
                    <LineBreak/>
                    <Run Text="1. Open WhatsApp on your phone"/>
                    <LineBreak/>
                    <Run Text="2. Go to Settings → Linked Devices"/>
                    <LineBreak/>
                    <Run Text="3. Tap 'Link a Device'"/>
                    <LineBreak/>
                    <Run Text="4. Scan the QR code above"/>
                </TextBlock>
            </StackPanel>

            <!-- Backend Mode -->
            <TextBlock Text="Backend Mode"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <StackPanel Margin="0,0,0,20">
                <TextBlock TextWrapping="Wrap" Margin="0,0,0,10" Opacity="0.7">
                    Choose which WhatsApp backend to use. Changes will take effect after restarting the connection.
                </TextBlock>

                <StackPanel Orientation="Horizontal">
                    <ComboBox x:Name="BackendModeCombo"
                              Width="300">
                        <ComboBoxItem Content="WhatsApp-Web.js (Recommended)" Tag="whatsapp-web.js"/>
                        <ComboBoxItem Content="Baileys (Lightweight)" Tag="baileys"/>
                    </ComboBox>

                    <styles:SHToggleCheckbox x:Name="DebugLoggingCheckBox"
                              Content="Debug Logging"
                              VerticalAlignment="Center"
                              Margin="20,0,0,0"
                              ToolTip="Enable detailed logging for troubleshooting. Logs are saved in the plugin's logs folder."/>
                </StackPanel>
            </StackPanel>

            <!-- Backend Versions -->
            <TextBlock Text="Backend Versions"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <StackPanel Margin="0,0,0,20">

                <!-- whatsapp-web.js -->
                <Border Background="#2D2D30" Padding="15" CornerRadius="4" Margin="0,0,0,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header row -->
                        <TextBlock Text="whatsapp-web.js" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>

                        <!-- Version and check row -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Version:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="WhatsAppWebJsVersionCombo" Width="150" Height="28"/>
                            <styles:SHButtonPrimary x:Name="WhatsAppWebJsInstallButton" Content="Install"
                                    Margin="10,0,0,0" Padding="10,5" Visibility="Collapsed"
                                    Background="#0E7A0D" Foreground="White"/>
                            <styles:SHButtonPrimary x:Name="WhatsAppWebJsCheckButton" Content="Check for updates"
                                    Margin="10,0,0,0" Padding="10,5"/>
                        </StackPanel>

                        <!-- Source row -->
                        <StackPanel Grid.Row="2">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Source:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <RadioButton x:Name="WhatsAppWebJsOfficialRadio" Content="Official"
                                             GroupName="WhatsAppWebJsSource" IsChecked="True" Margin="0,0,15,0"/>
                                <RadioButton x:Name="WhatsAppWebJsManualRadio" Content="Manual"
                                             GroupName="WhatsAppWebJsSource"/>
                            </StackPanel>
                            <StackPanel x:Name="WhatsAppWebJsManualPanel" Visibility="Collapsed">
                                <TextBlock Text="Format: github:user/repo#branch (e.g.: github:pedroslopez/whatsapp-web.js#main)"
                                           Foreground="#888" FontSize="11" Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Repository:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="WhatsAppWebJsRepoTextBox" Width="280" Height="28"/>
                                    <styles:SHButtonPrimary x:Name="WhatsAppWebJsApplyRepoButton" Content="Apply" Margin="10,0,0,0" Padding="10,5"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- baileys -->
                <Border Background="#2D2D30" Padding="15" CornerRadius="4" Margin="0,0,0,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header row -->
                        <TextBlock Text="baileys" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>

                        <!-- Version and check row -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Version:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="BaileysVersionCombo" Width="150" Height="28"/>
                            <styles:SHButtonPrimary x:Name="BaileysInstallButton" Content="Install"
                                    Margin="10,0,0,0" Padding="10,5" Visibility="Collapsed"
                                    Background="#0E7A0D" Foreground="White"/>
                            <styles:SHButtonPrimary x:Name="BaileysCheckButton" Content="Check for updates"
                                    Margin="10,0,0,0" Padding="10,5"/>
                        </StackPanel>

                        <!-- Source row -->
                        <StackPanel Grid.Row="2">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Source:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <RadioButton x:Name="BaileysOfficialRadio" Content="Official"
                                             GroupName="BaileysSource" IsChecked="True" Margin="0,0,15,0"/>
                                <RadioButton x:Name="BaileysManualRadio" Content="Manual"
                                             GroupName="BaileysSource"/>
                            </StackPanel>
                            <StackPanel x:Name="BaileysManualPanel" Visibility="Collapsed">
                                <TextBlock Text="Format: github:user/repo#branch (e.g.: github:WhiskeySockets/Baileys#main)"
                                           Foreground="#888" FontSize="11" Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Repository:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="BaileysRepoTextBox" Width="280" Height="28"/>
                                    <styles:SHButtonPrimary x:Name="BaileysApplyRepoButton" Content="Apply" Margin="10,0,0,0" Padding="10,5"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Scripts -->
                <Border Background="#2D2D30" Padding="15" CornerRadius="4">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Text="Scripts" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>

                        <!-- whatsapp-server.js row -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="whatsapp-server.js:" VerticalAlignment="Center" Width="140"/>
                            <Border Background="#252526" BorderBrush="#3E3E42" BorderThickness="1"
                                    Width="80" Height="28" VerticalAlignment="Center">
                                <TextBlock x:Name="WwjsScriptVersionText" Text=""
                                           VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <styles:SHButtonPrimary x:Name="WwjsScriptUpdateButton" Content="New Update"
                                    Margin="10,0,0,0" Padding="10,5" Visibility="Collapsed"
                                    Background="#0E7A0D" Foreground="White"/>
                        </StackPanel>

                        <!-- baileys-server.mjs row -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="baileys-server.mjs:" VerticalAlignment="Center" Width="140"/>
                            <Border Background="#252526" BorderBrush="#3E3E42" BorderThickness="1"
                                    Width="80" Height="28" VerticalAlignment="Center">
                                <TextBlock x:Name="BaileysScriptVersionText" Text=""
                                           VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <styles:SHButtonPrimary x:Name="BaileysScriptUpdateButton" Content="New Update"
                                    Margin="10,0,0,0" Padding="10,5" Visibility="Collapsed"
                                    Background="#0E7A0D" Foreground="White"/>
                        </StackPanel>

                        <!-- Check for updates button -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="140,0,0,0">
                            <styles:SHButtonPrimary x:Name="ScriptsCheckButton" Content="Check for updates"
                                    Padding="10,5"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- Dependencies Setup -->
            <TextBlock Text="Dependencies Setup"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#00BCD4"
                       Margin="0,0,0,5"/>
            <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

            <StackPanel Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                    <TextBlock Text="Status:" FontWeight="SemiBold" Margin="0,0,10,0" VerticalAlignment="Center"/>
                    <TextBlock x:Name="DependenciesStatusText" Text="✅ All dependencies installed"
                               Foreground="#0E7A0D" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Dependencies checklist -->
                <StackPanel x:Name="DependenciesChecklistPanel" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock x:Name="NodeJsStatusIcon" Text="✓" FontWeight="Bold"
                                   Foreground="#0E7A0D" Margin="0,0,8,0"/>
                        <TextBlock x:Name="NodeJsStatusText" Text="Node.js installed"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock x:Name="GitStatusIcon" Text="✓" FontWeight="Bold"
                                   Foreground="#0E7A0D" Margin="0,0,8,0"/>
                        <TextBlock x:Name="GitStatusText" Text="Git installed"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock x:Name="NpmPackagesStatusIcon" Text="✓" FontWeight="Bold"
                                   Foreground="#0E7A0D" Margin="0,0,8,0"/>
                        <TextBlock x:Name="NpmPackagesStatusText" Text="npm packages installed"/>
                    </StackPanel>
                </StackPanel>

                <TextBlock x:Name="DependenciesProgressText" Text=""
                           Foreground="#858585" FontSize="12"
                           TextWrapping="Wrap" Visibility="Collapsed" Margin="0,5,0,0"/>
            </StackPanel>

            <!-- Information -->
            <Border Background="#1E3A5F" Padding="12" CornerRadius="6" Margin="0,0,0,10">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="ℹ️" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                        <TextBlock Text="Information" FontSize="14" FontWeight="Bold" Foreground="White"/>
                    </StackPanel>
                    <TextBlock TextWrapping="Wrap" Foreground="White" FontSize="12" LineHeight="20">
                        <Run Text="• Your WhatsApp session is stored locally and encrypted"/>
                        <LineBreak/>
                        <Run Text="• If you don't want to receive WhatsApp messages, just click Disconnect"/>
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Troubleshooting Tips -->
            <Border Background="#1E3A5F" Padding="12" CornerRadius="6">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="⚠️" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                        <TextBlock Text="Troubleshooting Tips" FontSize="14" FontWeight="Bold" Foreground="White"/>
                    </StackPanel>
                    <TextBlock TextWrapping="Wrap" Foreground="White" FontSize="12" LineHeight="20">
                        <Run Text="• If connection fails, try Disconnect and then Connect"/>
                        <LineBreak/>
                        <Run Text="• If you get 'Connection Error', try 'Reset Session' to clear saved authentication"/>
                        <LineBreak/>
                        <Run Text="• On your phone, go to WhatsApp → Settings → Linked Devices and remove this device, then scan QR code again"/>
                        <LineBreak/>
                        <Run Text="• Try switching backend mode (WhatsApp-Web.js ↔ Baileys)"/>
                        <LineBreak/>
                        <Run Text="• Try changing backend version or use a custom repository in Source Manual"/>
                        <LineBreak/>
                        <Run Text="• Check for script updates using 'Check for updates' button"/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
