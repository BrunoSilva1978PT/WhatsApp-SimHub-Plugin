<UserControl x:Class="WhatsAppSimHubPlugin.UI.SettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins"
             xmlns:ui="clr-namespace:SimHub.Plugins.UI;assembly=SimHub.Plugins"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">



    <Grid Margin="10" >
        <!-- Toast Notification - Above Tabs -->
        <Border x:Name="ToastNotification"
                Background="#2D2D30"
                BorderBrush="#007ACC"
                BorderThickness="1"
                CornerRadius="5"
                Padding="15,10"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,-50,0,0"
                Visibility="Collapsed"
                MaxWidth="400"
                Panel.ZIndex="999">
            <Border.Effect>
                <DropShadowEffect Color="#007ACC" Opacity="0.6" BlurRadius="15" ShadowDepth="0"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock x:Name="ToastIcon"
                           Text="â„¹ï¸"
                           FontSize="20"
                           Margin="0,0,10,0"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="ToastMessage"
                           Text="Notification"
                           FontSize="14"
                           Foreground="White"
                           TextWrapping="Wrap"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <styles:SHTabControl>
            <!-- TAB 1: CONNECTION -->
            <styles:SHTabItem Header="ðŸ”Œ Connection">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <!-- Connection Status -->
                        <TextBlock Text="Connection Status"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <Ellipse x:Name="StatusIndicator" Width="15" Height="15"
                                             Fill="#E74877" Margin="0,0,10,0"/>
                                    <TextBlock x:Name="StatusText" Text="Disconnected"
                                               FontSize="14" VerticalAlignment="Center"/>
                                </StackPanel>

                                <TextBlock x:Name="ConnectedNumberText" Text="No number connected"
                                           Margin="0,0,0,10"/>

                                <StackPanel Orientation="Horizontal">
                                    <styles:SHButtonSecondary x:Name="DisconnectButton" Content="Disconnect"
                                            Width="100" Margin="0,0,10,0" IsEnabled="False"
                                            Background="#E74877" Foreground="White"
                                            Click="DisconnectButton_Click"/>
                                    <styles:SHButtonPrimary x:Name="ReconnectButton" Content="Connect"
                                            Width="100" Margin="0,0,10,0"
                                            Background="#0E7A0D" Foreground="White"
                                            Click="ReconnectButton_Click"/>
                                    <styles:SHButtonSecondary x:Name="ResetSessionButton" Content="Reset Session"
                                            Width="110"
                                            Background="#FF9800" Foreground="White"
                                            Click="ResetSessionButton_Click"/>
                                </StackPanel>
                        </StackPanel>

                        <!-- QR Code -->
                        <TextBlock Text="QR Code"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">
                            <Image x:Name="QRCodeImage" Width="300" Height="300"
                                       Stretch="Uniform" Margin="0,0,0,10"
                                       HorizontalAlignment="Left" Visibility="Collapsed"/>

                                <TextBlock x:Name="QRCodeInstructions" TextWrapping="Wrap"
                                           Visibility="Collapsed">
                                    <Run Text="To connect:"/>
                                    <LineBreak/>
                                    <Run Text="1. Open WhatsApp on your phone"/>
                                    <LineBreak/>
                                    <Run Text="2. Go to Settings â†’ Linked Devices"/>
                                    <LineBreak/>
                                    <Run Text="3. Tap 'Link a Device'"/>
                                    <LineBreak/>
                                    <Run Text="4. Scan the QR code above"/>
                                </TextBlock>
                        </StackPanel>

                        <!-- Backend Mode -->
                        <TextBlock Text="Backend Mode"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock TextWrapping="Wrap" Margin="0,0,0,10" Opacity="0.7">
                                    Choose which WhatsApp backend to use. Changes will take effect after restarting the connection.
                                </TextBlock>

                                <ComboBox x:Name="BackendModeCombo"
                                          Width="300" HorizontalAlignment="Left"
                                          SelectionChanged="BackendModeCombo_SelectionChanged">
                                    <ComboBoxItem Content="WhatsApp-Web.js (Recommended)" Tag="whatsapp-web.js"/>
                                    <ComboBoxItem Content="Baileys (Lightweight)" Tag="baileys"/>
                                </ComboBox>
                        </StackPanel>

                        <!-- Backend Versions -->
                        <TextBlock Text="Backend Versions"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">

                            <!-- whatsapp-web.js -->
                            <Border Background="#2D2D30" Padding="15" CornerRadius="4" Margin="0,0,0,10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Header row -->
                                        <Grid Grid.Row="0" Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="whatsapp-web.js" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                                            <TextBlock x:Name="WhatsAppWebJsUpdateBadge" Grid.Column="1" Text="NEW UPDATE"
                                                       Foreground="#25D366" FontWeight="Bold" FontSize="11"
                                                       VerticalAlignment="Center" Visibility="Collapsed"
                                                       Cursor="Hand" MouseLeftButtonUp="WhatsAppWebJsUpdateBadge_Click"/>
                                        </Grid>

                                        <!-- Version and check row -->
                                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                                            <TextBlock Text="Version:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <ComboBox x:Name="WhatsAppWebJsVersionCombo" Width="150" Height="28"
                                                      SelectionChanged="WhatsAppWebJsVersionCombo_SelectionChanged"/>
                                            <styles:SHButtonPrimary x:Name="WhatsAppWebJsInstallButton" Content="Install"
                                                    Margin="10,0,0,0" Padding="10,5" Visibility="Collapsed"
                                                    Background="#0E7A0D" Foreground="White"
                                                    Click="WhatsAppWebJsInstallButton_Click"/>
                                            <styles:SHButtonPrimary x:Name="WhatsAppWebJsCheckButton" Content="Check for updates"
                                                    Margin="10,0,0,0" Padding="10,5"
                                                    Click="WhatsAppWebJsCheckButton_Click"/>
                                        </StackPanel>

                                        <!-- Source row -->
                                        <StackPanel Grid.Row="2">
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="Source:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <RadioButton x:Name="WhatsAppWebJsOfficialRadio" Content="Official"
                                                             GroupName="WhatsAppWebJsSource" IsChecked="True"
                                                             Checked="WhatsAppWebJsSourceRadio_Changed" Margin="0,0,15,0"/>
                                                <RadioButton x:Name="WhatsAppWebJsManualRadio" Content="Manual"
                                                             GroupName="WhatsAppWebJsSource"
                                                             Checked="WhatsAppWebJsSourceRadio_Changed"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" x:Name="WhatsAppWebJsManualPanel" Visibility="Collapsed">
                                                <TextBlock Text="Repository:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBox x:Name="WhatsAppWebJsRepoTextBox" Width="280" Height="28"/>
                                                <styles:SHButtonPrimary Content="Apply" Margin="10,0,0,0" Padding="10,5"
                                                        Click="WhatsAppWebJsApplyRepo_Click"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                            <!-- baileys -->
                            <Border Background="#2D2D30" Padding="15" CornerRadius="4" Margin="0,0,0,10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Header row -->
                                        <Grid Grid.Row="0" Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="baileys" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                                            <TextBlock x:Name="BaileysUpdateBadge" Grid.Column="1" Text="NEW UPDATE"
                                                       Foreground="#25D366" FontWeight="Bold" FontSize="11"
                                                       VerticalAlignment="Center" Visibility="Collapsed"
                                                       Cursor="Hand" MouseLeftButtonUp="BaileysUpdateBadge_Click"/>
                                        </Grid>

                                        <!-- Version and check row -->
                                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                                            <TextBlock Text="Version:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <ComboBox x:Name="BaileysVersionCombo" Width="150" Height="28"
                                                      SelectionChanged="BaileysVersionCombo_SelectionChanged"/>
                                            <styles:SHButtonPrimary x:Name="BaileysInstallButton" Content="Install"
                                                    Margin="10,0,0,0" Padding="10,5" Visibility="Collapsed"
                                                    Background="#0E7A0D" Foreground="White"
                                                    Click="BaileysInstallButton_Click"/>
                                            <styles:SHButtonPrimary x:Name="BaileysCheckButton" Content="Check for updates"
                                                    Margin="10,0,0,0" Padding="10,5"
                                                    Click="BaileysCheckButton_Click"/>
                                        </StackPanel>

                                        <!-- Source row -->
                                        <StackPanel Grid.Row="2">
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="Source:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <RadioButton x:Name="BaileysOfficialRadio" Content="Official"
                                                             GroupName="BaileysSource" IsChecked="True"
                                                             Checked="BaileysSourceRadio_Changed" Margin="0,0,15,0"/>
                                                <RadioButton x:Name="BaileysManualRadio" Content="Manual"
                                                             GroupName="BaileysSource"
                                                             Checked="BaileysSourceRadio_Changed"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" x:Name="BaileysManualPanel" Visibility="Collapsed">
                                                <TextBlock Text="Repository:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBox x:Name="BaileysRepoTextBox" Width="280" Height="28"/>
                                                <styles:SHButtonPrimary Content="Apply" Margin="10,0,0,0" Padding="10,5"
                                                        Click="BaileysApplyRepo_Click"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                            <!-- Scripts -->
                            <Border Background="#2D2D30" Padding="15" CornerRadius="4">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Header -->
                                    <Grid Grid.Row="0" Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Scripts" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="ScriptsUpdateBadge" Grid.Column="1" Text="NEW UPDATE"
                                                   Foreground="#25D366" FontWeight="Bold" FontSize="11"
                                                   VerticalAlignment="Center" Visibility="Collapsed"
                                                   Cursor="Hand" MouseLeftButtonUp="ScriptsUpdateBadge_Click"/>
                                    </Grid>

                                    <!-- Version row -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal">
                                        <TextBlock Text="Version:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <Border Background="#252526" BorderBrush="#3E3E42" BorderThickness="1"
                                                Width="150" Height="28" VerticalAlignment="Center">
                                            <TextBlock x:Name="ScriptsVersionText" Text=""
                                                       VerticalAlignment="Center" Margin="8,0,0,0"/>
                                        </Border>
                                        <styles:SHButtonPrimary x:Name="ScriptsCheckButton" Content="Check for updates"
                                                Margin="10,0,0,0" Padding="10,5"
                                                Click="ScriptsCheckButton_Click"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </StackPanel>

                        <!-- Dependencies Setup -->
                        <TextBlock Text="Dependencies Setup"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                    <TextBlock Text="Status:" FontWeight="SemiBold" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="DependenciesStatusText" Text="âœ… All dependencies installed"
                                               Foreground="#0E7A0D" VerticalAlignment="Center"/>
                                </StackPanel>

                                <!-- Dependencies checklist -->
                                <StackPanel x:Name="DependenciesChecklistPanel" Margin="0,0,0,10">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock x:Name="NodeJsStatusIcon" Text="âœ“" FontWeight="Bold"
                                                   Foreground="#0E7A0D" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="NodeJsStatusText" Text="Node.js installed"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock x:Name="GitStatusIcon" Text="âœ“" FontWeight="Bold"
                                                   Foreground="#0E7A0D" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="GitStatusText" Text="Git installed"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock x:Name="NpmPackagesStatusIcon" Text="âœ“" FontWeight="Bold"
                                                   Foreground="#0E7A0D" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="NpmPackagesStatusText" Text="npm packages installed"/>
                                    </StackPanel>
                                </StackPanel>

                            <TextBlock x:Name="DependenciesProgressText" Text=""
                                       Foreground="#858585" FontSize="12"
                                       TextWrapping="Wrap" Visibility="Collapsed" Margin="0,5,0,0"/>
                        </StackPanel>

                        <!-- Troubleshooting Info -->
                        <Border Background="#1E3A5F" Padding="12" CornerRadius="6">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="â„¹ï¸" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                                    <TextBlock Text="Troubleshooting Tips" FontSize="14" FontWeight="Bold" Foreground="White"/>
                                </StackPanel>
                                <TextBlock TextWrapping="Wrap" Foreground="White" FontSize="12" LineHeight="20">
                                    <Run Text="â€¢ If connection fails, try Disconnect and then Connect"/>
                                    <LineBreak/>
                                    <Run Text="â€¢ If you get 'Connection Error', try 'Reset Session' to clear saved authentication"/>
                                    <LineBreak/>
                                    <Run Text="â€¢ On your phone, go to WhatsApp â†’ Settings â†’ Linked Devices and remove this device, then scan QR code again"/>
                                    <LineBreak/>
                                    <Run Text="â€¢ Try switching backend mode (WhatsApp-Web.js â†” Baileys)"/>
                                    <LineBreak/>
                                    <Run Text="â€¢ Try changing backend version or use a custom repository in Source Manual"/>
                                    <LineBreak/>
                                    <Run Text="â€¢ Check for script updates using 'Check for updates' button"/>
                                    <LineBreak/>
                                    <Run Text="â€¢ Your WhatsApp session is stored locally and encrypted"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </styles:SHTabItem>

            <!-- TAB 2: CONTACTS -->
            <styles:SHTabItem Header="ðŸ‘¥ Contacts">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Manage Allowed Contacts List -->
                        <TextBlock Grid.Row="0" Text="Manage Allowed Contacts List"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Grid.Row="0" Height="1" Background="#00BCD4" Margin="0,25,0,15"/>

                        <!-- Add from Active Chats -->
                        <Border Grid.Row="1" Background="#2D2D30" Padding="15" CornerRadius="8" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="ðŸ“± Add from Active Chats"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Foreground="#D4D4D4"
                                          Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox x:Name="ChatContactsComboBox"
                                             Grid.Column="0"
                                             IsEnabled="False"
                                             DisplayMemberPath="DisplayText"
                                             Background="#252526"
                                             Foreground="#D4D4D4"
                                             BorderBrush="#3E3E42"
                                             Height="32"
                                             Margin="0,0,10,0"
                                             FontSize="13"/>

                                    <styles:SHButtonPrimary x:Name="RefreshChatsButton"
                                           Grid.Column="1"
                                           Content="ðŸ”„ Refresh"
                                           IsEnabled="False"
                                           Background="#007ACC"
                                           Foreground="White"
                                           Width="110"
                                           Height="32"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Margin="0,0,10,0"
                                           ToolTip="Refresh contacts list"
                                           Click="RefreshChatsButton_Click"/>

                                    <styles:SHButtonPrimary x:Name="AddFromChatsButton"
                                           Grid.Column="2"
                                           Content="âž• Add"
                                           IsEnabled="False"
                                           Background="#0E7A0D"
                                           Foreground="White"
                                           Padding="15,6"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Click="AddFromChatsButton_Click"/>
                                </Grid>

                                <TextBlock x:Name="ChatsStatusText"
                                          Text="â³ Waiting for WhatsApp connection..."
                                          Foreground="#858585"
                                          FontSize="11"
                                          Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Manual Add -->
                        <Border Grid.Row="2" Background="#2D2D30" Padding="15" CornerRadius="8" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="âž• Add Contact"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Foreground="#D4D4D4"
                                          Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox x:Name="ManualNameTextBox"
                                            Grid.Column="0"
                                            Text="Name"
                                            Background="#252526"
                                            Foreground="#D4D4D4"
                                            BorderBrush="#3E3E42"
                                            Height="40"
                                            Margin="0,0,10,0"
                                            Padding="10,8"
                                            FontSize="13"
                                            VerticalContentAlignment="Center"
                                            VerticalScrollBarVisibility="Disabled"
                                            HorizontalScrollBarVisibility="Disabled"/>

                                    <TextBox x:Name="ManualNumberTextBox"
                                            Grid.Column="1"
                                            Text="+351..."
                                            Background="#252526"
                                            Foreground="#D4D4D4"
                                            BorderBrush="#3E3E42"
                                            Height="40"
                                            Margin="0,0,10,0"
                                            Padding="10,8"
                                            FontSize="13"
                                            VerticalContentAlignment="Center"
                                            VerticalScrollBarVisibility="Disabled"
                                            HorizontalScrollBarVisibility="Disabled"/>

                                    <styles:SHButtonPrimary x:Name="AddManualButton"
                                           Grid.Column="2"
                                           Content="âž• Add"
                                           Background="#0E7A0D"
                                           Foreground="White"
                                           Padding="15,6"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Click="AddManualButton_Click"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Allowed Contacts Header -->
                        <Border Grid.Row="3" Background="#2D2D30" Padding="15,10,15,5" CornerRadius="8,8,0,0">
                            <TextBlock Text="ðŸ“‹ Allowed Contacts"
                                      FontSize="16"
                                      FontWeight="SemiBold"
                                      Foreground="#D4D4D4"/>
                        </Border>

                        <!-- Contacts DataGrid -->
                        <Border Grid.Row="4" Background="#252526" Padding="0" CornerRadius="0,0,8,8">
                            <DataGrid x:Name="ContactsDataGrid"
                                         AutoGenerateColumns="False"
                                         CanUserAddRows="False"
                                         CanUserDeleteRows="False"
                                         CanUserReorderColumns="False"
                                         CanUserResizeRows="False"
                                         CanUserSortColumns="True"
                                         Background="#252526"
                                         RowBackground="#2D2D30"
                                         AlternatingRowBackground="#252526"
                                         BorderThickness="0"
                                         GridLinesVisibility="None"
                                         HeadersVisibility="Column"
                                         SelectionMode="Single"
                                         IsReadOnly="False">

                                    <DataGrid.ColumnHeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#3E3E42"/>
                                            <Setter Property="Foreground" Value="#D4D4D4"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Padding" Value="10,8"/>
                                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                            <Setter Property="BorderBrush" Value="#858585"/>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>

                                    <!-- ðŸŽ¨ Row Style - Remover highlight azul ao selecionar -->
                                    <DataGrid.RowStyle>
                                        <Style TargetType="DataGridRow">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Foreground" Value="#D4D4D4"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="Foreground" Value="#D4D4D4"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#3E3E42"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.RowStyle>

                                    <!-- ðŸŽ¨ Cell Style - Remover highlight azul nas cÃ©lulas -->
                                    <DataGrid.CellStyle>
                                        <Style TargetType="DataGridCell">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="Foreground" Value="#D4D4D4"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.CellStyle>

                                    <DataGrid.Columns>
                                        <!-- Name Column -->
                                        <DataGridTextColumn Header="Name"
                                                          Binding="{Binding Name}"
                                                          Width="*"
                                                          IsReadOnly="True">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#D4D4D4"/>
                                                    <Setter Property="Padding" Value="10,8"/>
                                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                        <!-- Number Column -->
                                        <DataGridTextColumn Header="Number"
                                                          Binding="{Binding FormattedNumber}"
                                                          Width="150"
                                                          IsReadOnly="True">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#D4D4D4"/>
                                                    <Setter Property="Padding" Value="10,8"/>
                                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                        <!-- VIP Checkbox Column -->
                                        <DataGridTemplateColumn Header="â­ VIP" Width="80">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <styles:SHToggleCheckbox IsChecked="{Binding IsVip, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                             HorizontalAlignment="Center"
                                                             VerticalAlignment="Center"
                                                             Checked="ContactVipCheckBox_Changed"
                                                             Unchecked="ContactVipCheckBox_Changed"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <!-- Actions Column -->
                                        <DataGridTemplateColumn Header="Actions" Width="100">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <styles:SHButtonPrimary Content="ðŸ—‘ï¸ Remove"
                                                           Tag="{Binding}"
                                                           Background="#C42B1C"
                                                           Foreground="White"
                                                           BorderThickness="0"
                                                           Padding="8,4"
                                                           FontSize="11"
                                                           Click="RemoveContactButton_Click"
                                                           Margin="5,2"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                            </DataGrid>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </styles:SHTabItem>

            <!-- TAB 3: KEYWORDS -->
            <styles:SHTabItem Header="ðŸš¨ Keywords">
                <StackPanel Margin="20">

                    <!-- Urgent Keywords -->
                    <TextBlock Text="Urgent Keywords"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="#00BCD4"
                               Margin="0,0,0,5"/>
                    <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                    <!-- Add New Keyword -->
                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="+ Add New Keyword"
                                   FontWeight="Bold"
                                   FontSize="14"
                                   Margin="0,0,0,12"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0" x:Name="NewKeyword"
                                     Margin="0,0,10,0"
                                     Height="36"
                                     KeyDown="NewKeyword_KeyDown"/>

                            <styles:SHButtonPrimary Grid.Column="1" Content="âž• Add"
                                    Width="100" Height="36"
                                    Background="#0E7A0D"
                                    Foreground="White"
                                    Click="AddKeyword_Click"/>
                        </Grid>
                    </StackPanel>

                    <!-- Keywords List -->
                    <ListBox x:Name="KeywordsListBox"
                             MinHeight="150"
                             MaxHeight="300"
                             Background="#252526"
                             Padding="5"
                             Margin="0,0,0,20">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#2D2D30"
                                        CornerRadius="4"
                                        Padding="12,8"
                                        Margin="0,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="{Binding}"
                                                   VerticalAlignment="Center"
                                                   FontSize="13"
                                                   Foreground="White"/>

                                        <styles:SHButtonPrimary Grid.Column="1" Content="ðŸ—‘ï¸ Remove"
                                                Width="110" Height="28"
                                                Background="#C42B1C"
                                                Foreground="White"
                                                FontSize="11"
                                                Click="RemoveKeyword_Click"
                                                Tag="{Binding}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- Info -->
                    <Border Background="#1E3A5F" Padding="12" CornerRadius="6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â„¹ï¸" FontSize="18" Margin="0,0,12,0" VerticalAlignment="Top" Foreground="White"/>
                            <TextBlock TextWrapping="Wrap"
                                       Foreground="White"
                                       FontSize="12"
                                       LineHeight="18">
                                Messages containing these keywords will be marked as URGENT.
                                <LineBreak/>
                                Urgent messages have higher priority and repeat until read.
                            </TextBlock>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </styles:SHTabItem>

            <!-- TAB 4: DISPLAY -->
            <styles:SHTabItem Header="ðŸ–¥ï¸ Display">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <!-- Target Device -->
                        <TextBlock Text="Target Device"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="VoCore Device:"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal">
                                <ComboBox x:Name="TargetDeviceComboBox"
                                          Width="380"
                                          Height="36"
                                          Background="#252526"
                                          Foreground="White"
                                          BorderBrush="#3E3E42"
                                          SelectionChanged="TargetDeviceCombo_SelectionChanged">
                                    <!-- Devices will be loaded dynamically -->
                                </ComboBox>

                                <styles:SHButtonPrimary x:Name="RefreshDevicesButton" Content="ðŸ”„ Refresh"
                                        Click="RefreshDevicesButton_Click"
                                        Width="110" Height="36"
                                        Margin="10,0,0,0"
                                        Background="#007ACC"
                                        Foreground="White"
                                        ToolTip="Refresh VoCore device list"/>

                                <styles:SHButtonPrimary x:Name="TestOverlayButton" Content="ðŸ§ª Test"
                                        Click="TestOverlayButton_Click"
                                        Width="100" Height="36"
                                        Margin="10,0,0,0"
                                        Background="#0E7A0D"
                                        Foreground="White"
                                        ToolTip="Test overlay on selected VoCore"/>

                                <TextBlock x:Name="DeviceStatusLabel"
                                           Text="Checking..."
                                           VerticalAlignment="Center"
                                           Margin="15,0,0,0"
                                           FontSize="12"
                                           FontWeight="Bold"/>
                            </StackPanel>

                            <Border Background="#1E3A5F" Padding="12" CornerRadius="6" Margin="0,15,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â„¹ï¸" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                                    <TextBlock Text="Select a VoCore to display WhatsApp notifications during races."
                                               Foreground="White"
                                               FontSize="12"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>


                    </StackPanel>
                </ScrollViewer>
            </styles:SHTabItem>

            <!-- TAB 5: QUEUE -->
            <styles:SHTabItem Header="â±ï¸ Queue">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">

                        <!-- Message Display Duration -->
                        <TextBlock Text="Message Display Duration"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">

                                <!-- Normal duration -->
                                <TextBlock Text="Normal message duration:"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"/>
                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="NormalDurationSlider" Grid.Column="0"
                                            Minimum="5" Maximum="30" Value="5"
                                            TickFrequency="1" IsSnapToTickEnabled="True"
                                            VerticalAlignment="Center"
                                            ValueChanged="NormalDurationSlider_ValueChanged"/>
                                    <TextBlock x:Name="NormalDurationValue" Grid.Column="1"
                                               Text="5s" FontWeight="Bold"
                                               VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Grid>

                                <!-- VIP/Urgent duration -->
                                <TextBlock Text="VIP/Urgent message duration:"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="UrgentDurationSlider" Grid.Column="0"
                                            Minimum="10" Maximum="60" Value="10"
                                            TickFrequency="1" IsSnapToTickEnabled="True"
                                            VerticalAlignment="Center"
                                            ValueChanged="UrgentDurationSlider_ValueChanged"/>
                                    <TextBlock x:Name="UrgentDurationValue" Grid.Column="1"
                                               Text="10s" FontWeight="Bold"
                                               VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Grid>

                            <Border Background="#1E3A5F" Padding="12" CornerRadius="6" Margin="0,15,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â„¹ï¸" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                                    <TextBlock TextWrapping="Wrap"
                                               Foreground="White"
                                               FontSize="12">
                                        How long messages stay visible on screen.
                                        <LineBreak/>
                                        VIP/Urgent messages display for longer.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Queue Limits -->
                        <TextBlock Text="Queue Limits"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">

                                <!-- Max messages per contact -->
                                <TextBlock Text="Max messages per contact:"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"/>
                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="MaxMessagesPerContactSlider" Grid.Column="0"
                                            Minimum="1" Maximum="10" Value="5"
                                            TickFrequency="1" IsSnapToTickEnabled="True"
                                            VerticalAlignment="Center"
                                            ValueChanged="MaxMessagesPerContactSlider_ValueChanged"/>
                                    <TextBlock x:Name="MaxMessagesPerContactValue" Grid.Column="1"
                                               Text="5" FontWeight="Bold"
                                               VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Grid>

                                <!-- Max queue size -->
                                <TextBlock Text="Max queue size:"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="MaxQueueSizeSlider" Grid.Column="0"
                                            Minimum="1" Maximum="50" Value="10"
                                            TickFrequency="1" IsSnapToTickEnabled="True"
                                            VerticalAlignment="Center"
                                            ValueChanged="MaxQueueSizeSlider_ValueChanged"/>
                                    <TextBlock x:Name="MaxQueueSizeValue" Grid.Column="1"
                                               Text="10" FontWeight="Bold"
                                               VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Grid>

                            <Border Background="#1E3A5F"
                                    Padding="12"
                                    CornerRadius="6"
                                    Margin="0,15,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â„¹ï¸" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                                    <TextBlock TextWrapping="Wrap"
                                               Foreground="White"
                                               FontSize="12">
                                        Controls how many messages can be queued.
                                        <LineBreak/>
                                        Older messages are removed when limits are reached.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- VIP/Urgent Message Behavior -->
                        <TextBlock Text="VIP/Urgent Message Behavior"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <StackPanel Margin="0,0,0,20">

                                <!-- Remove after first display -->
                                <styles:SHToggleCheckbox x:Name="RemoveAfterFirstDisplayCheckbox"
                                         Content="âŒ Remove VIP/Urgent after first display"
                                         FontSize="13"
                                         Foreground="White"
                                         Margin="0,0,0,15"
                                         Checked="RemoveAfterFirstDisplayCheckbox_Changed"
                                         Unchecked="RemoveAfterFirstDisplayCheckbox_Changed"/>

                                <!-- Repeat interval (only visible when RemoveAfterFirstDisplay is OFF) -->
                                <StackPanel x:Name="ReminderIntervalPanel" Margin="0,0,0,15">
                                    <TextBlock Text="Repeat interval for VIP/Urgent messages:"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Margin="0,0,0,8"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider x:Name="ReminderIntervalSlider" Grid.Column="0"
                                                Minimum="1" Maximum="10" Value="3"
                                                TickFrequency="1" IsSnapToTickEnabled="True"
                                                VerticalAlignment="Center"
                                                ValueChanged="ReminderIntervalSlider_ValueChanged"/>
                                        <TextBlock x:Name="ReminderIntervalValue" Grid.Column="1"
                                                   Text="3 min" FontWeight="Bold"
                                                   VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                    </Grid>
                                </StackPanel>

                            <Border Background="#1E3A5F"
                                    Padding="12"
                                    CornerRadius="6"
                                    Margin="0,15,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â„¹ï¸" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                                    <TextBlock TextWrapping="Wrap"
                                               Foreground="White"
                                               FontSize="12">
                                        VIP/Urgent messages can repeat until read.
                                        <LineBreak/>
                                        Enable "Remove after first display" to prevent repeats.
                                        <LineBreak/>
                                        When repeating, the interval defines how long to show normal queue between VIP/Urgent repeats.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </styles:SHTabItem>

            <!-- TAB 6: QUICK REPLIES -->
            <styles:SHTabItem Header="âš¡ Quick Replies">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">

                        <!-- Quick Replies Settings -->
                        <TextBlock Text="Quick Replies Settings"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#00BCD4"
                                   Margin="0,0,0,5"/>
                        <Border Height="1" Background="#00BCD4" Margin="0,0,0,15"/>

                        <!-- Reply 1 -->
                        <Border Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <!-- TÃ­tulo + BotÃ£o na mesma linha -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Quick Reply 1 Trigger button"
                                               FontSize="14"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,15,0"/>

                                    <!-- Placeholder para ControlsEditor (SEM border cinza) -->
                                    <ContentPresenter Grid.Column="1"
                                                      x:Name="Reply1ControlEditorPlaceholder"
                                                      VerticalAlignment="Center"/>
                                </Grid>

                                <TextBlock Text="Reply text:" Margin="0,0,0,5"/>
                                <TextBox x:Name="Reply1TextBox"
                                         Text="Estou numa corrida, ligo depois ðŸŽï¸"
                                         Margin="0,0,0,0"
                                         TextChanged="Reply1TextBox_TextChanged"/>
                            </StackPanel>
                        </Border>

                        <!-- Reply 2 -->
                        <Border Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <!-- TÃ­tulo + BotÃ£o na mesma linha -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Quick Reply 2 Trigger button"
                                               FontSize="14"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"
                                               Margin="0,0,15,0"/>

                                    <!-- Placeholder para ControlsEditor (SEM border cinza) -->
                                    <ContentPresenter Grid.Column="1"
                                                      x:Name="Reply2ControlEditorPlaceholder"
                                                      VerticalAlignment="Center"/>
                                </Grid>

                                <TextBlock Text="Reply text:" Margin="0,0,0,5"/>
                                <TextBox x:Name="Reply2TextBox"
                                         Text="Se for urgente liga sff ðŸ“ž"
                                         Margin="0,0,0,0"
                                         TextChanged="Reply2TextBox_TextChanged"/>
                            </StackPanel>
                        </Border>

                        <!-- Options -->
                        <Border Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="Options" FontSize="14" FontWeight="Bold" Margin="0,0,0,10"/>

                                <styles:SHToggleCheckbox x:Name="ShowConfirmationCheck"
                                          Content="Show confirmation in overlay when reply is sent"
                                          IsChecked="True" Margin="0,0,0,5"/>
                            </StackPanel>
                        </Border>

                        <!-- Info Box -->
                        <Border Background="#1E3A5F" Padding="12" CornerRadius="6" Margin="0,15,0,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="â„¹ï¸" FontSize="16" Margin="0,0,10,0" Foreground="White"/>
                                <TextBlock TextWrapping="Wrap" Foreground="White" FontSize="12">
                                    <Run Text="When a message appears during a race, press the configured button to send the quick reply."/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </styles:SHTabItem>
        </styles:SHTabControl>
    </Grid>
</UserControl>
